<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tutorial: Criando e Executando uma API ASP.NET Core no Docker</title>
    <link rel="stylesheet" href="../css/styles.css"> <!-- Caminho atualizado para o CSS -->


</head>
<div class="container">

    <body>
        <h1>Tutorial: Criando e Executando uma API ASP.NET Core no Docker</h1>
        <h2>Objetivo</h2>
        <p>Neste tutorial, você aprenderá a criar uma API simples usando ASP.NET Core e publicá-la no Docker. Vamos
            abordar a configuração do ambiente, a criação da API, a criação do Dockerfile, a construção da imagem Docker
            e como executar a aplicação no contêiner.</p>

        <h2>Pré-requisitos</h2>
        <ul>
            <li><strong>.NET SDK</strong>: Certifique-se de ter o .NET SDK instalado em sua máquina. Você pode baixá-lo
                em <a href="https://dotnet.microsoft.com/download">dotnet.microsoft.com</a>.</li>
            <li><strong>Docker</strong>: Instale o Docker em sua máquina. Você pode encontrar instruções em <a
                    href="https://docs.docker.com/get-docker/">docs.docker.com</a>.</li>
        </ul>

        <h2>Passo 1: Criar o Projeto da API</h2>
        <ol>
            <li><strong>Abra o terminal</strong> e navegue até o diretório onde deseja criar a sua API.</li>
            <li>Execute o seguinte comando para criar um novo projeto ASP.NET Core Web API:
                <pre><code>dotnet new webapi -n MyApiDocker</code></pre>
            </li>
            <li>Navegue para o diretório do projeto:
                <pre><code>cd MyApiDocker</code></pre>
            </li>
        </ol>

        <h2>Passo 2: Modificar o Código da API</h2>
        <ol>
            <li><strong>Abra o arquivo <code>Program.cs</code></strong>. Este arquivo contém a configuração da sua
                aplicação.</li>
            <li>Modifique o código para incluir o Swagger e redirecionar a rota raiz para o Swagger. O código deve ficar
                assim:
                <pre><code>var builder = WebApplication.CreateBuilder(args);

            <section id="about">
                // Adicionar serviços ao contêiner.
                builder.Services.AddControllers();
                builder.Services.AddEndpointsApiExplorer();
                builder.Services.AddSwaggerGen();

                var app = builder.Build();

                // Redirecionar a rota raiz para o Swagger
                app.MapGet("/", () => Results.Redirect("/swagger/index.html"));

                app.UseSwagger();
                app.UseSwaggerUI(c =>
                {
                    c.SwaggerEndpoint("/swagger/v1/swagger.json", "My API V1");
                    c.RoutePrefix = "swagger"; // Define a URL base do Swagger
                });

                app.UseHttpsRedirection();
                app.UseAuthorization();
                app.MapControllers();
                app.Run();
        </section>


</code></pre>
            </li>
        </ol>

        <h2>Passo 3: Criar o Dockerfile</h2>
        <ol>
            <li><strong>Na raiz do seu projeto, crie um arquivo chamado <code>Dockerfile</code></strong> e adicione o
                seguinte conteúdo:
                <pre>
                <section id="about">
                    <code>

                    # Usar a imagem base do .NET SDK para construir a aplicação
                    FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build-env
                    WORKDIR /app

                    # Copiar o arquivo .csproj e restaurar dependências
                    COPY *.csproj ./
                    RUN dotnet restore

                    # Copiar todo o código e compilar a aplicação
                    COPY . ./
                    RUN dotnet publish -c Release -o out

                    # Usar a imagem base do .NET Runtime para executar a aplicação
                    FROM mcr.microsoft.com/dotnet/aspnet:8.0
                    WORKDIR /app
                    COPY --from=build-env /app/out ./

                    # Expor a porta 80
                    EXPOSE 80

                    # Comando para executar a aplicação
                    ENTRYPOINT ["dotnet", "MyApiDocker.dll"]
                    </code>
                </section>
            </pre>
            </li>
        </ol>

        <h2>Passo 4: Construir a Imagem Docker</h2>
        <ol>
            <li>No terminal, ainda na raiz do seu projeto, execute o seguinte comando para construir a imagem Docker:
                <pre><code>docker build -t myapidocker .</code></pre>
                <p>- <code>-t myapidocker</code>: Nome da imagem que você está criando.<br>
                    - <code>.</code>: O ponto indica que o Docker deve usar o Dockerfile no diretório atual.</p>
            </li>
        </ol>

        <h2>Passo 5: Executar a Aplicação no Docker</h2>
        <ol>
            <li>Após a imagem ser construída, você pode executar a aplicação em um contêiner Docker com o seguinte
                comando:
                <pre><code>docker run -d -p 5000:80 --name myapi_container myapidocker</code></pre>
                <p>- <code>-d</code>: Executa o contêiner em modo destacado (background).<br>
                    - <code>-p 5000:80</code>: Mapeia a porta 80 do contêiner para a porta 5000 da sua máquina.<br>
                    - <code>--name myapi_container</code>: Nome do contêiner que será criado.<br>
                    - <code>myapidocker</code>: O nome da imagem que você criou.</p>
            </li>
        </ol>

        <h2>Passo 6: Testar a Aplicação</h2>
        <ol>
            <li>Abra um navegador e acesse <code>http://localhost:5000/</code>. Você deverá ser redirecionado para
                <code>http://localhost:5000/swagger/index.html</code>, onde poderá visualizar a interface do Swagger.
            </li>
        </ol>

        <h2>Atualizando a Aplicação no Docker</h2>
        <p><strong>Importante:</strong> Sempre que você modificar o código da sua aplicação, será necessário seguir os
            seguintes passos para garantir que as alterações sejam refletidas no Docker:</p>
        <ol>
            <li><strong>Parar o contêiner existente:</strong>
                <pre><code>docker stop myapi_container</code></pre>
            </li>
            <li><strong>Remover o contêiner:</strong>
                <pre><code>docker rm myapi_container</code></pre>
            </li>
            <li><strong>Reconstruir a imagem Docker:</strong>
                <pre><code>docker build -t myapidocker .</code></pre>
            </li>
            <li><strong>Criar e executar um novo contêiner:</strong>
                <pre><code>docker run -d -p 5000:80 --name myapi_container myapidocker</code></pre>
            </li>
        </ol>

        <h2>Conclusão</h2>
        <p>Neste tutorial, você aprendeu a criar uma API ASP.NET Core e a executá-la em um contêiner Docker. Também
            discutimos como atualizar sua aplicação no Docker sempre que houver alterações no código.</p>
        <p>Se você tiver mais perguntas ou precisar de mais assistência, não hesite em perguntar!</p>
</div>
</body>

</html>